(dp1
S'output'
p2
S'<class \'gluon.contrib.pg8000.ProgrammingError\'> (\'ERROR\', \'42601\', \'syntax error at or near "DESC"\')'
p3
sS'layer'
p4
S'/var/www/web2py/applications/teste_chat/controllers/home.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\nfrom gluon.contrib.websocket_messaging import websocket_send\nimport datetime\n@auth.requires_login()\ndef index():\n\tdb(db.amigos.nome == auth.user.first_name).update(status=\'Disponivel\')\n\tuser_amigos = db(db.amigos.nome == auth.user.first_name).select().as_list()\n\tif user_amigos == []:\n\t\tdb.amigos.insert(id_user=auth.user.id,nome=auth.user.first_name,status=\'Disponivel\')\n\n\tsession.usuario_logado = []\n\tsession.usuario_logado = [auth.user.first_name]\n\tsession.usuario_logado += [auth.user.id]\n\ttipoMsg = \'atualizaUsuario\'\n\tsocketAtualizaUsuario(tipoMsg)\n\treturn response.render(\'home/index.html\')\n\n@auth.requires_login()\ndef atualiza():\n\tuser_amigos = db(db.amigos.nome == auth.user.first_name).select().as_list()\n\tif user_amigos == []:\n\t\tdb.amigos.insert(id_user=auth.user.id,nome=auth.user.first_name,status=\'Disponivel\')\n\ttipoMsg = \'atualizaUsuario\'\n\tsocketAtualizaUsuario()\n\n\treturn response.render(\'home/index.html\')\n\ndef login():\n\tif auth.user is None:\n\t\tform = auth.login()\n\t\tform.element(_name=\'email\')[\'_class\'] = "form-control"\n\t\tform.element(_name=\'password\')[\'_class\'] = "form-control"\n\t\tform.element(_name=\'email\')[\'_placeholder\'] = \'E-mail\'\n\t\tform.element(_name=\'password\')[\'_placeholder\'] = \'Senha\'\n\t\tform.element(_type=\'submit\')[\'_class\'] = "btn btn-outline btn-primary btn-lg btn-block"\n\t\treturn response.render(\'home/login.html\', form=form)\n\telse:\n\t\treturn redirect(URL(\'index\'))\n\ndef registro():\n\treturn auth.register()\n\n@auth.requires_login()\ndef usuarios_online():\n\tamigos = db(db.amigos.nome != auth.user.first_name).select()\n\testado = db(db.amigos.id_user == auth.user.id).select(\'status\')\n\treturn response.render(\'sub_view/usuarios_online.html\',ativos=amigos,status=estado)\n\n@auth.requires_login()\ndef get_chat():\n\tchat = db(db.chat.id_user == auth.user.id).select()\n\treturn response.render(\'sub_view/chat.html\',chat=chat)\n\n@auth.requires_login()\ndef logout():\n\tdb(db.amigos.id_user == auth.user.id).update(status = \'Offline\')\n\ttipoMsg = \'atualizaUsuario\'\n\tsocketAtualizaUsuario(tipoMsg)\n\tauth.logout()\n\n@auth.requires_login()\ndef retira_usuario():\n\tquery = (db.amigos.nome == auth.user.first_name)\n\tdb(db.amigos.id_user == auth.user.id).update(status = \'Offline\')\n\ttipoMsg = \'atualizaUsuario\'\n\tsocketAtualizaUsuario(tipoMsg)\n\treturn redirect(URL(\'index\'))\n\n@auth.requires_login()\ndef trocar_status():\n\tdb(db.amigos.id_user == auth.user.id).update(status = request.vars[\'status\'])\n\ttipoMsg = \'atualizaUsuario\'\n\tsocketAtualizaUsuario(tipoMsg)\n\treturn True\n\n#Fun\xc3\xa7\xc3\xb5es Sockets\n#Fun\xc3\xa7\xc3\xa3o socketAtualizaUsuario para atualizar o frame de Usuarios Logados\n@auth.requires_login()\t\ndef socketAtualizaUsuario(tipoMsg=""):\n\twebsocket_send(\'http://127.0.0.1:8888\',tipoMsg,\'chat\',\'conversa\')\n\n@auth.requires_login()\ndef abrir_conversa():\n\tid_envio = request.vars[\'id\']\n\tusuario_envio = db(db.auth_user.id ==  id_envio).select()\n\tif usuario_envio.as_list() != []:\n\t\tsession.id_envio = id_envio\n\t\tsession.usuario_envio=usuario_envio\n\tmensagens = db(((db.chat.id_user == session.id_envio) | (db.chat.id_recebido == session.id_envio)) & ((db.chat.id_user == auth.user.id) | (db.chat.id_recebido == auth.user.id))).select(orderby=db.chat.data_envio)\n\treturn response.render(\'sub_view/chat.html\',mensagens=mensagens,usuario_envio=session.usuario_envio)\n@auth.requires_login()\ndef envia_mensagem():\n\tmensagem = request.vars[\'mensagem\']\n\tid_envio = request.vars[\'id_envio\']\n\tdb.chat.insert(nome=auth.user.first_name,mensagem=mensagem,id_user=auth.user.id,id_recebido=id_envio,data_envio=datetime.datetime.now())\n\ttipoMsg = \'atualizaChat\'\n\tsocketAtualizaUsuario(tipoMsg)\n\n@auth.requires_login()\ndef recebe_mensagem():\n\tdados = db(db.mensagem).select(groupby=~db.chat.data_envio)\n\treturn response.render(\'sub_view/linha_tempo.html\',dados=dados)\n\n@auth.requires_login()\ndef nova_publicacao():\n\tdados = request.vars[\'mensagem\']\n\tdb.mensagem.insert(mensagem = dados,nome = auth.user.first_name, id_user = auth.user.id, data_envio = datetime.datetime.now())\n\ttipoMsg = \'atualizaLinhadoTempo\'\n\tsocketAtualizaUsuario(tipoMsg)\n\nresponse._vars=response._caller(recebe_mensagem)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/var/www/web2py/gluon/restricted.py", line 227, in restricted\n    exec ccode in environment\n  File "/var/www/web2py/applications/teste_chat/controllers/home.py", line 111, in <module>\n  File "/var/www/web2py/gluon/globals.py", line 393, in <lambda>\n    self._caller = lambda f: f()\n  File "/var/www/web2py/gluon/tools.py", line 3440, in f\n    return action(*a, **b)\n  File "/var/www/web2py/applications/teste_chat/controllers/home.py", line 101, in recebe_mensagem\n    dados = db(db.mensagem).select(groupby=~db.chat.data_envio)\n  File "/var/www/web2py/gluon/packages/dal/pydal/objects.py", line 2093, in select\n    return adapter.select(self.query,fields,attributes)\n  File "/var/www/web2py/gluon/packages/dal/pydal/adapters/base.py", line 1239, in select\n    return self._select_aux(sql,fields,attributes)\n  File "/var/www/web2py/gluon/packages/dal/pydal/adapters/base.py", line 1204, in _select_aux\n    self.execute(sql)\n  File "/var/www/web2py/gluon/packages/dal/pydal/adapters/base.py", line 1326, in execute\n    return self.log_execute(*a, **b)\n  File "/var/www/web2py/gluon/packages/dal/pydal/adapters/base.py", line 1320, in log_execute\n    ret = self.cursor.execute(command, *a[1:], **b)\n  File "/var/www/web2py/gluon/contrib/pg8000/core.py", line 573, in execute\n    self._c.execute(self, operation, args)\n  File "/var/www/web2py/gluon/contrib/pg8000/core.py", line 1626, in execute\n    self.handle_messages(cursor)\n  File "/var/www/web2py/gluon/contrib/pg8000/core.py", line 1774, in handle_messages\n    raise self.error\nProgrammingError: (\'ERROR\', \'42601\', \'syntax error at or near "DESC"\')\n'
p11
s.